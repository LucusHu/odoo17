<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="helpdesk_ticket_inherit_signature" name="Ticket Portal Template"
              inherit_id="helpdesk_mgmt.portal_helpdesk_ticket_page">
        <xpath expr="//span[@t-field='ticket.last_stage_update']" position="replace">
            <span t-field="ticket.last_stage_update"/>
            <br/>
            <br/>
            <div class="row mt-4" name="signature">
                <div t-if="ticket.signature">
                    <h5>Signature</h5>
                    <img t-att-src="image_data_uri(ticket.signature)" style="max-height: 6rem; max-width: 100%;"/>
                    <p t-field="ticket.signed_by"/>
                </div>
            </div>
            <!--                <span t-field="ticket.signature" widget="signature"/>-->
        </xpath>
        <xpath expr="//t[@t-call='portal.message_thread']" position="before">
            <div class="row justify-content-center text-center d-print-none pt-1 pb-4">
                <div class="col-sm-auto mt8">
                    <a role="button" class="btn btn-primary btn-block mb8" data-toggle="modal"
                       data-target="#modalaccept" href="#">
                        <i class="fa fa-check"/>
                        <!--                        <t>Accept &amp; Sign</t>-->
                        <t>簽名同意</t>
                    </a>
                </div>
                <div role="dialog" class="modal fade" id="modalaccept">
                    <div class="modal-dialog">
                        <form id="accept" method="POST" t-att-data-order-id="ticket_id"
                              t-att-data-token="token"
                              class="js_accept_json modal-content js_website_submit_form">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <header class="modal-header">
                                <h4 class="modal-title">Validate Ticket</h4>
                                <button type="button" class="close" data-dismiss="modal"
                                        aria-label="Close">
                                    ×
                                </button>
                            </header>
                            <main class="modal-body" id="sign-dialog">

                                <t t-call="portal.signature_form">

                                    <t t-set="call_url"
                                       t-value="ticket.get_portal_url(suffix='/accept')"/>
                                    <t t-set="default_name" t-value="partner_name"/>
                                </t>
                            </main>
                        </form>
                    </div>
                </div>
            </div>
        </xpath>


    </template>

</odoo>